<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Address Finder</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f1f5f9;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .card {
            background: white;
            width: 100%;
            max-width: 500px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .search-area {
            background: #4f46e5;
            padding: 30px;
            text-align: center;
        }

        .search-box {
            display: flex;
            background: rgba(255,255,255,0.2);
            padding: 5px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.3);
        }

        input {
            flex: 1;
            background: transparent;
            border: none;
            color: white;
            padding: 10px;
            outline: none;
            font-size: 1rem;
        }
        input::placeholder { color: rgba(255,255,255,0.7); }

        button {
            background: white;
            color: #4f46e5;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
        }
        button:hover { background: #e0e7ff; }

        .result-area {
            padding: 20px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        .info-row:last-child { border-bottom: none; }

        .label { color: #64748b; font-size: 0.9rem; }
        .val { font-weight: 600; color: #1e293b; text-align: right;}

        #map {
            height: 250px;
            width: 100%;
        }
        
        .error { color: red; text-align: center; margin-top: 10px; display: none; }
    </style>
</head>
<body>

    <div class="card">
        <div class="search-area">
            <h2 style="color:white; margin-bottom:15px;">IP Lookup</h2>
            <div class="search-box">
                <input type="text" id="ipInput" placeholder="Enter IP (e.g. 8.8.8.8)">
                <button onclick="searchIP()">Search</button>
            </div>
            <p id="error-msg" class="error"></p>
        </div>

        <div id="map"></div>

        <div class="result-area">
            <div class="info-row">
                <span class="label">IP Address</span>
                <span class="val" id="res-ip">--</span>
            </div>
            <div class="info-row">
                <span class="label">Country</span>
                <span class="val">
                    <img id="flag" src="" width="20" style="vertical-align:middle; display:none;"> 
                    <span id="res-country">--</span>
                </span>
            </div>
            <div class="info-row">
                <span class="label">City</span>
                <span class="val" id="res-city">--</span>
            </div>
            <div class="info-row">
                <span class="label">Calling Code</span>
                <span class="val" id="res-code">--</span>
            </div>
            <div class="info-row">
                <span class="label">ISP / Org</span>
                <span class="val" id="res-isp">--</span>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let map = L.map('map').setView([20, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        let marker;

        // Auto-fetch user IP on load
        fetchIP('');

        function searchIP() {
            const input = document.getElementById('ipInput').value;
            fetchIP(input);
        }

        function fetchIP(ip) {
            // Using ipwho.is which supports querying specific IPs (e.g., ipwho.is/8.8.8.8)
            const url = `https://ipwho.is/${ip}`;
            const errorMsg = document.getElementById('error-msg');
            
            errorMsg.style.display = 'none';

            fetch(url)
                .then(res => res.json())
                .then(data => {
                    if(!data.success) {
                        errorMsg.textContent = "Invalid IP Address";
                        errorMsg.style.display = 'block';
                        return;
                    }

                    // Update UI
                    document.getElementById('res-ip').textContent = data.ip;
                    document.getElementById('res-country').textContent = data.country;
                    document.getElementById('res-city').textContent = data.city;
                    document.getElementById('res-code').textContent = "+" + data.calling_code;
                    document.getElementById('res-isp').textContent = data.connection.org || data.connection.isp;

                    // Update Flag
                    const flag = document.getElementById('flag');
                    flag.src = data.flag.img;
                    flag.style.display = 'inline-block';

                    // Update Map
                    if(data.latitude && data.longitude) {
                        const lat = data.latitude;
                        const lng = data.longitude;
                        
                        map.setView([lat, lng], 13);
                        
                        if(marker) map.removeLayer(marker);
                        marker = L.marker([lat, lng]).addTo(map)
                            .bindPopup(`<b>${data.city}</b><br>${data.country}`).openPopup();
                    }
                })
                .catch(err => {
                    errorMsg.textContent = "Network Error";
                    errorMsg.style.display = 'block';
                });
        }
    </script>
</body>
</html>
